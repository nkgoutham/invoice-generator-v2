import{l as u,s as i,V as o}from"./index-DMTdQ3St.js";const d=u((n,s)=>({currencySettings:null,loading:!1,error:null,fetchCurrencySettings:async t=>{n({loading:!0,error:null});try{const{data:r,error:e}=await i.from("currency_settings").select("*").eq("user_id",t).single();if(e){if(e.code==="PGRST116"){n({currencySettings:{id:"default",user_id:t,preferred_currency:"INR",usd_to_inr_rate:85,created_at:new Date().toISOString()},error:null,loading:!1});return}throw e}n({currencySettings:r,error:null})}catch(r){console.error("Error fetching currency settings:",r),n({error:r.message||"Failed to fetch currency settings",currencySettings:{id:"default",user_id:t,preferred_currency:"INR",usd_to_inr_rate:85,created_at:new Date().toISOString()}})}finally{n({loading:!1})}},updateCurrencySettings:async t=>{n({loading:!0,error:null});const{currencySettings:r}=s();try{if(!r)throw new Error("No currency settings found");if(r.id==="default"){const{data:e,error:c}=await i.from("currency_settings").insert({user_id:r.user_id,preferred_currency:t.preferred_currency||r.preferred_currency,usd_to_inr_rate:t.usd_to_inr_rate||r.usd_to_inr_rate}).select("*").single();if(c)throw c;n({currencySettings:e,error:null})}else{const{data:e,error:c}=await i.from("currency_settings").update({...t}).eq("id",r.id).select("*").single();if(c)throw c;n({currencySettings:e,error:null})}o.success("Currency settings updated")}catch(e){console.error("Error updating currency settings:",e),n({error:e.message||"Failed to update currency settings"}),o.error("Failed to update currency settings")}finally{n({loading:!1})}},convertCurrency:(t,r,e)=>{const{currencySettings:c}=s();if(r===e)return t;const a=(c==null?void 0:c.usd_to_inr_rate)||85;return r==="USD"&&e==="INR"?t*a:r==="INR"&&e==="USD"?t/a:t}}));export{d as u};
