import{u as A,r as l,j as e,L as x,R as u,V as j}from"./index-DMTdQ3St.js";import{u as L}from"./recurringInvoiceStore-Bk_4mFo2.js";import{F as _}from"./invoice-BGlX5FmL.js";import{a as b}from"./helpers-kgrKKtTT.js";import{P as v}from"./plus-circle-DtCdQUqZ.js";import{S as E}from"./search-DQGV9Rah.js";import{F as T}from"./filter-CpVmvab7.js";import{C as $}from"./check-circle-HEDH94gZ.js";import{X as P}from"./x-circle-CJq5NwBv.js";import{C as D}from"./calendar-CRwE0Pfy.js";import{C as V}from"./clock-BUTmNg2j.js";import{A as O}from"./arrow-right-Q1W384Tb.js";const W=()=>{const{user:i}=A(),{recurringInvoices:r,loading:N,error:h,fetchRecurringInvoices:d,toggleRecurringInvoiceStatus:y}=L(),[c,w]=l.useState(""),[m,C]=l.useState("all"),[o,R]=l.useState([]),[f,g]=l.useState(!1);l.useEffect(()=>{i&&d(i.id)},[i,d]),l.useEffect(()=>{if(r){let s=[...r];if(c){const a=c.toLowerCase();s=s.filter(t=>{var n,p;return t.title.toLowerCase().includes(a)||((n=t.clients)==null?void 0:n.name)&&t.clients.name.toLowerCase().includes(a)||((p=t.clients)==null?void 0:p.company_name)&&t.clients.company_name.toLowerCase().includes(a)})}m!=="all"&&(s=s.filter(a=>a.status===m)),R(s)}},[r,c,m]);const S=async()=>{i&&(g(!0),await d(i.id),setTimeout(()=>g(!1),800))},k=async(s,a)=>{try{const t=a==="active"?"inactive":"active";await y(s,t),j.success(`Recurring invoice ${t==="active"?"activated":"deactivated"}`)}catch{j.error("Failed to update recurring invoice status")}},F=s=>{const a=_.find(t=>t.value===s);return a?a.label:s};return N&&!r.length?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader h-12 w-12"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Recurring Invoices"}),e.jsxs(x,{to:"/recurring/new",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Create Recurring Invoice"]})]}),h&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:h}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(E,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Search recurring invoices...",value:c,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(T,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:m,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex items-center justify-start lg:justify-center",children:[e.jsx(u,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[o.length," recurring invoice",o.length!==1?"s":""]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:S,disabled:f,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(u,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),"Refresh"]})})]})})}),o.length>0?e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:o.map(s=>{var a,t;return e.jsx("li",{children:e.jsx(x,{to:`/recurring/${s.id}`,className:"block hover:bg-gray-50",children:e.jsxs("div",{className:"px-4 py-4 sm:px-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600 truncate mr-2",children:s.title}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[s.status==="active"?e.jsx($,{className:"h-3 w-3 mr-1"}):e.jsx(P,{className:"h-3 w-3 mr-1"}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(D,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"truncate mr-2 hidden sm:inline",children:["Next: ",b(s.next_issue_date)]}),e.jsx("span",{className:"truncate sm:ml-2 sm:mr-2 hidden sm:inline",children:"â€¢"}),e.jsx("span",{className:"truncate",children:F(s.frequency)})]})]}),e.jsxs("div",{className:"mt-2 sm:flex sm:justify-between",children:[e.jsx("div",{className:"flex items-center text-sm text-gray-500",children:e.jsxs("span",{className:"truncate",children:["Client:",e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:((a=s.clients)==null?void 0:a.company_name)||((t=s.clients)==null?void 0:t.name)||"Client"})]})}),e.jsxs("div",{className:"mt-2 flex items-center text-sm sm:mt-0",children:[e.jsx(V,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-500",children:["Created: ",b(s.created_at)]})]})]}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),k(s.id,s.status)},className:`text-xs font-medium px-2.5 py-1.5 rounded-md ${s.status==="active"?"text-red-700 bg-red-50 hover:bg-red-100":"text-green-700 bg-green-50 hover:bg-green-100"}`,children:s.status==="active"?"Deactivate":"Activate"}),e.jsxs("div",{className:"text-sm font-medium text-blue-600 flex items-center",children:["View details",e.jsx(O,{className:"ml-1 h-4 w-4"})]})]})]})})},s.id)})})}):e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 text-center",children:[e.jsx(u,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No recurring invoices found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r.length>0?"No recurring invoices match your search criteria. Try adjusting your filters.":"Get started by creating your first recurring invoice."}),r.length===0&&e.jsx("div",{className:"mt-6",children:e.jsxs(x,{to:"/recurring/new",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Create Recurring Invoice"]})})]})]})};export{W as default};
