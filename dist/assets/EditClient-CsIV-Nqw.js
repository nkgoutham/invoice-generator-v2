import{d as k,a as R,r as m,j as e,g as u}from"./index-DMTdQ3St.js";import{u as b}from"./clientStore-Bedc05g4.js";import{e as D}from"./helpers-kgrKKtTT.js";import{A as I}from"./arrow-left-DgZupmuo.js";const H=()=>{const{id:a}=k(),g=R(),{getClient:f,updateClient:j,fetchEngagementModel:h,updateEngagementModel:_,loading:N}=b(),[l,c]=m.useState({name:"",company_name:"",billing_address:"",gst_number:"",contact_person:"",email:"",phone:"",status:"active",engagement_status:"active"}),[n,d]=m.useState({type:"service",retainer_amount:"",project_value:"",service_rates:[{name:"Hourly Rate",rate:0,unit:"hour",currency:"INR"}]}),[y,v]=m.useState(!1),[x,C]=m.useState(!1);m.useEffect(()=>{(async()=>{if(a)try{const t=await f(a);t&&(c({name:t.name||"",company_name:t.company_name||"",billing_address:t.billing_address||"",gst_number:t.gst_number||"",contact_person:t.contact_person||"",email:t.email||"",phone:t.phone||"",status:t.status||"active",engagement_status:t.engagement_status||"active"}),C(!0))}catch(t){console.error("Error loading client:",t),u.error("Failed to load client data")}})()},[a,f]),m.useEffect(()=>{(async()=>{if(a&&x)try{await h(a);const t=b.getState().engagementModel;t&&(d({type:t.type||"service",retainer_amount:t.retainer_amount?String(t.retainer_amount):"",project_value:t.project_value?String(t.project_value):"",service_rates:t.service_rates&&t.service_rates.length>0?t.service_rates.map(r=>({...r,currency:r.currency||"INR"})):[{name:"Hourly Rate",rate:0,unit:"hour",currency:"INR"}]}),t.type==="retainership"?c(r=>({...r,engagement_status:"retainer"})):t.type==="project"&&c(r=>({...r,engagement_status:"project"})))}catch(t){console.error("Error loading engagement model:",t)}})()},[a,h,x]);const i=s=>{const{name:t,value:r}=s.target;c(o=>({...o,[t]:r}))},w=s=>{const t=s.target.value;d(r=>({...r,type:t})),c(t==="retainership"?r=>({...r,engagement_status:"retainer"}):t==="project"?r=>({...r,engagement_status:"project"}):r=>({...r,engagement_status:"active"}))},p=s=>{const{name:t,value:r}=s.target;if(t==="retainer_amount"||t==="project_value")d(o=>({...o,[t]:r}));else if(t==="hourly_rate"){const o=[...n.service_rates];o[0]={...o[0],rate:parseFloat(r)||0},d(S=>({...S,service_rates:o}))}},E=s=>{const t=s.target.value,r=[...n.service_rates];r[0]={...r[0],currency:t},d(o=>({...o,service_rates:r}))},F=async s=>{if(s.preventDefault(),!l.name.trim()){u.error("Client name is required");return}if(!a){u.error("Client ID is missing");return}v(!0);try{await j(a,l);const t=b.getState().engagementModel;if(t){const r={type:n.type,retainer_amount:n.type==="retainership"&&parseFloat(n.retainer_amount)||null,project_value:n.type==="project"&&parseFloat(n.project_value)||null,service_rates:n.type==="service"?n.service_rates:null};await _(t.id,r)}u.success("Client updated successfully"),g(`/clients/${a}`)}catch(t){console.error("Error updating client:",t),u.error("Failed to update client")}finally{v(!1)}};return N&&!x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>g(`/clients/${a}`),className:"text-gray-500 hover:text-gray-700 mr-4",children:e.jsx(I,{size:20})}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Edit Client"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("form",{onSubmit:F,className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.name,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"company_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx("input",{type:"text",id:"company_name",name:"company_name",value:l.company_name,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contact_person",className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),e.jsx("input",{type:"text",id:"contact_person",name:"contact_person",value:l.contact_person,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:l.email,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"text",id:"phone",name:"phone",value:l.phone,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"billing_address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Billing Address"}),e.jsx("textarea",{id:"billing_address",name:"billing_address",value:l.billing_address,onChange:i,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gst_number",className:"block text-sm font-medium text-gray-700 mb-1",children:"GST Number"}),e.jsx("input",{type:"text",id:"gst_number",name:"gst_number",value:l.gst_number,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:l.status,onChange:i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"prospect",children:"Prospect"})]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Engagement Details"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"engagement_type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Engagement Type *"}),e.jsx("select",{id:"engagement_type",name:"engagement_type",value:n.type,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:D.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),n.type==="retainership"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"retainer_amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Retainer Amount"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex items-center justify-center bg-gray-100 px-3 border border-r-0 border-gray-300 rounded-l-md",children:"₹"}),e.jsx("input",{type:"number",id:"retainer_amount",name:"retainer_amount",value:n.retainer_amount,onChange:p,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-r-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]})]}),n.type==="project"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project_value",className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Value"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex items-center justify-center bg-gray-100 px-3 border border-r-0 border-gray-300 rounded-l-md",children:"₹"}),e.jsx("input",{type:"number",id:"project_value",name:"project_value",value:n.project_value,onChange:p,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-r-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]})]}),n.type==="service"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hourly_rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Hourly Rate"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"flex col-span-3",children:[e.jsxs("select",{id:"rate_currency",className:"flex items-center justify-center bg-gray-100 px-3 border border-r-0 border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",value:n.service_rates[0].currency||"INR",onChange:E,children:[e.jsx("option",{value:"INR",children:"₹"}),e.jsx("option",{value:"USD",children:"$"})]}),e.jsx("input",{type:"number",id:"hourly_rate",name:"hourly_rate",value:n.service_rates[0].rate,onChange:p,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-r-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsx("div",{className:"text-gray-500 flex items-center text-sm",children:"per hour"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>g(`/clients/${a}`),className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-70",children:y?"Saving...":"Update Client"})]})]})})})]})};export{H as default};
