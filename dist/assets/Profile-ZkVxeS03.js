import{u as k,b as B,r as a,j as e,V as n}from"./index-DMTdQ3St.js";import{u as A}from"./index.esm-DkrFlcfS.js";import{U as C}from"./upload-CjiI9HH6.js";import{A as $}from"./alert-circle-DEjQuPjF.js";import{S as U}from"./save-Cq4unuqE.js";const R=()=>{const{user:d}=k(),{profile:r,loading:m,error:h,fetchProfile:c,updateProfile:v,uploadLogo:_}=B(),[u,y]=a.useState(null),[x,i]=a.useState(null),[z,F]=a.useState(window.innerWidth<640),[j,b]=a.useState(null),[f,g]=a.useState(!1),{register:l,handleSubmit:P,reset:w,formState:{errors:t,isDirty:N}}=A();a.useEffect(()=>{const s=()=>{F(window.innerWidth<640)};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),a.useEffect(()=>{(async()=>{d&&await c(d.id)})()},[d,c]),a.useEffect(()=>{if(r)if(w({business_name:r.business_name,address:r.address,pan_number:r.pan_number,phone:r.phone,logo_url:r.logo_url,primary_color:r.primary_color||"#3B82F6",secondary_color:r.secondary_color||"#0EA5E9",footer_text:r.footer_text}),r.logo_url){const s=new Date().getTime(),o=r.logo_url.includes("?")?`${r.logo_url}&t=${s}`:`${r.logo_url}?t=${s}`;i(o)}else i(null)},[r,w]);const E=s=>s.size>1024*1024?(b("Logo file must be smaller than 1MB"),!1):["image/jpeg","image/png","image/gif","image/webp"].includes(s.type)?(b(null),!0):(b("Logo must be an image (JPEG, PNG, GIF, or WEBP)"),!1),S=s=>{if(s.target.files&&s.target.files[0]){const o=s.target.files[0];if(!E(o)){s.target.value="";return}y(o);const p=new FileReader;p.onload=()=>{i(p.result)},p.readAsDataURL(o)}},L=async s=>{if(d)try{g(!0);let o=null;if(u){if(o=await _(u,d.id),!o)throw new Error("Failed to upload logo");n.success("Logo uploaded successfully"),y(null)}g(!1),N&&(await v({...s,user_id:d.id}),n.success("Profile updated successfully")),await c(d.id)}catch(o){g(!1),n.error(o.message||"Failed to update profile")}};return m&&!r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-0",children:e.jsxs("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"px-4 py-4 sm:px-6 border-b",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Profile Settings"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Your personal and business information"})]}),h&&e.jsx("div",{className:"m-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:h}),e.jsxs("form",{onSubmit:P(L),children:[e.jsx("div",{className:"px-4 py-5 sm:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-y-6",children:[e.jsxs("div",{className:"sm:col-span-2 flex flex-col items-center",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden mb-2 relative",children:f?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 bg-opacity-75",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):x?e.jsx("img",{src:x,alt:"Business logo",className:"h-full w-full object-cover",onError:s=>{const o=s.target;o.onerror=null,o.src="",i(null),n.error("Failed to load logo")}}):e.jsx(C,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("label",{htmlFor:"logo",className:"cursor-pointer flex items-center text-sm font-medium text-blue-600 hover:text-blue-500 mt-2",children:[e.jsx("span",{children:x?"Change logo":"Upload logo"}),e.jsx("input",{id:"logo",type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",className:"sr-only",onChange:S,disabled:f})]}),j&&e.jsxs("div",{className:"mt-2 flex items-center text-sm text-red-600",children:[e.jsx($,{className:"h-4 w-4 mr-1"}),j]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center max-w-xs",children:"Upload a logo smaller than 1MB. JPG, PNG, GIF, and WEBP formats are supported."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"business_name",className:"block text-sm font-medium text-gray-700",children:"Business Name"}),e.jsx("input",{type:"text",id:"business_name",className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.business_name?"border-red-300":""}`,placeholder:"Your business name",...l("business_name",{required:"Business name is required"})}),t.business_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.business_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"text",id:"phone",className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.phone?"border-red-300":""}`,placeholder:"+91 9876543210",...l("phone")}),t.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pan_number",className:"block text-sm font-medium text-gray-700",children:"PAN Number"}),e.jsx("input",{type:"text",id:"pan_number",className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.pan_number?"border-red-300":""}`,placeholder:"ABCDE1234F",...l("pan_number")}),t.pan_number&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.pan_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700",children:"Address"}),e.jsx("textarea",{id:"address",rows:3,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm resize-none ${t.address?"border-red-300":""}`,placeholder:"Your business address",...l("address")}),t.address&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.address.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"primary_color",className:"block text-sm font-medium text-gray-700",children:"Primary Brand Color"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("input",{type:"color",id:"primary_color",className:"h-8 w-8 border border-gray-300 rounded-md cursor-pointer",...l("primary_color")}),e.jsx("input",{type:"text",className:"ml-2 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...l("primary_color")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"secondary_color",className:"block text-sm font-medium text-gray-700",children:"Secondary Brand Color"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("input",{type:"color",id:"secondary_color",className:"h-8 w-8 border border-gray-300 rounded-md cursor-pointer",...l("secondary_color")}),e.jsx("input",{type:"text",className:"ml-2 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...l("secondary_color")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"footer_text",className:"block text-sm font-medium text-gray-700",children:"Invoice Footer Text"}),e.jsx("textarea",{id:"footer_text",rows:2,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm resize-none",placeholder:"Thank you for your business!",...l("footer_text")}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This text will appear at the bottom of your invoices."})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6",children:e.jsxs("button",{type:"submit",disabled:m||!N&&!u,className:"w-full sm:w-auto inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),m||f?"Saving...":"Save Changes"]})})]})]})})};export{R as default};
