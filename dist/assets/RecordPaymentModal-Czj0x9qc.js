import{r as u,j as e}from"./index-DMTdQ3St.js";import{M as v}from"./Modal-D67shZbf.js";import{P as k}from"./invoice-BGlX5FmL.js";import{f as p}from"./helpers-kgrKKtTT.js";import{C as P}from"./calendar-CRwE0Pfy.js";import"./x-CNnEMBry.js";const R=({isOpen:b,onClose:y,onSave:g,invoice:s})=>{const x=new Date().toISOString().split("T")[0],[t,r]=u.useState({payment_date:x,payment_method:"bank_transfer",payment_reference:"",amount:s.total,is_partially_paid:!1}),[f,o]=u.useState(!1),[h,n]=u.useState(null),i=a=>{const{name:l,value:d,type:N}=a.target;if(N==="checkbox"){const m=a.target.checked;if(l==="is_partially_paid"){const c=m?0:s.total;r(w=>({...w,[l]:m,amount:c}))}else r(c=>({...c,[l]:m}))}else r(m=>({...m,[l]:d}));n(null)},_=a=>{const l=a.target.value===""?0:parseFloat(a.target.value);r(d=>({...d,amount:l})),n(null)},j=async a=>{if(a.preventDefault(),!t.payment_date){n("Please select a payment date");return}if(t.is_partially_paid&&t.amount<=0){n("Please enter a valid payment amount");return}if(t.is_partially_paid&&t.amount>=s.total){window.confirm("The amount you entered is equal to or greater than the total amount. Would you like to mark this as fully paid instead?")&&r(l=>({...l,is_partially_paid:!1,amount:s.total}));return}o(!0),o(!0);try{await g({...t,status:t.is_partially_paid?"partially_paid":"paid"})}catch(l){console.error("Error recording payment:",l),n("Failed to record payment. Please try again.")}finally{o(!1)}};return e.jsx(v,{isOpen:b,onClose:y,title:"Record Payment",size:"md",children:e.jsxs("form",{onSubmit:j,className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 text-red-700 text-sm",children:h}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Status"}),e.jsxs("div",{className:"mt-1 flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"full_payment",name:"is_partially_paid",type:"radio",checked:!t.is_partially_paid,onChange:()=>r(a=>({...a,is_partially_paid:!1,amount:s.total})),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"}),e.jsxs("label",{htmlFor:"full_payment",className:"ml-2 block text-sm text-gray-700",children:["Full Payment",e.jsxs("span",{className:"ml-1 text-sm text-gray-500",children:["(",p(s.total,s.currency),")"]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"partial_payment",name:"is_partially_paid",type:"radio",checked:t.is_partially_paid,onChange:()=>r(a=>({...a,is_partially_paid:!0,amount:0})),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"}),e.jsx("label",{htmlFor:"partial_payment",className:"ml-2 block text-sm text-gray-700",children:"Partial Payment"})]})]})]}),t.is_partially_paid&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Amount"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:s.currency==="USD"?"$":"â‚¹"})}),e.jsx("input",{type:"number",id:"amount",name:"amount",min:"0.01",step:"0.01",max:s.total.toString(),value:t.amount||"",onChange:_,className:"focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md",placeholder:""}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center",children:e.jsxs("span",{className:"text-gray-500 pr-3 text-xs sm:text-sm",children:["of ",p(s.total,s.currency)]})})]}),t.is_partially_paid&&t.amount>0&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Remaining balance: ",p(s.total-t.amount,s.currency)]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"payment_date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Date"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(P,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",id:"payment_date",name:"payment_date",value:t.payment_date,onChange:i,className:"focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-gray-300 rounded-md",max:x})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsx("select",{id:"payment_method",name:"payment_method",value:t.payment_method,onChange:i,className:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:k.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"payment_reference",className:"block text-sm font-medium text-gray-700 mb-1",children:["Reference / Transaction ID",e.jsx("span",{className:"ml-1 text-gray-400 text-xs",children:"(optional)"})]}),e.jsx("input",{type:"text",id:"payment_reference",name:"payment_reference",value:t.payment_reference,onChange:i,className:"mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"e.g., Bank reference, UPI ID, etc."})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row sm:justify-end space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{type:"button",onClick:y,className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"w-full sm:w-auto inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-70",children:f?"Saving...":"Record Payment"})]})]})})};export{R as default};
