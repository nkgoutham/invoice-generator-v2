import{u as h,r as d,j as e,D as _,R as j,s as c,V as l}from"./index-DMTdQ3St.js";import{u as v}from"./index.esm-DkrFlcfS.js";import{S as N}from"./save-Cq4unuqE.js";const C=()=>{const{user:s}=h(),[u,m]=d.useState(!1),[x,f]=d.useState(!1),{register:y,handleSubmit:g,setValue:o,formState:{errors:n,isDirty:p}}=v({defaultValues:{preferred_currency:"INR",usd_to_inr_rate:85}});d.useEffect(()=>{(async()=>{if(s){m(!0);try{const{data:r,error:a}=await c.from("currency_settings").select("*").eq("user_id",s.id).single();a?a.code!=="PGRST116"&&(console.error("Error fetching currency settings:",a),l.error("Failed to load currency settings")):r&&(o("preferred_currency",r.preferred_currency),o("usd_to_inr_rate",r.usd_to_inr_rate))}catch(r){console.error("Error in fetchSettings:",r)}finally{m(!1)}}})()},[s,o]);const b=async t=>{if(s){f(!0);try{const{data:r,error:a}=await c.from("currency_settings").select("id").eq("user_id",s.id).maybeSingle();let i;if(r?i=await c.from("currency_settings").update({preferred_currency:t.preferred_currency,usd_to_inr_rate:t.usd_to_inr_rate}).eq("user_id",s.id):i=await c.from("currency_settings").insert({user_id:s.id,preferred_currency:t.preferred_currency,usd_to_inr_rate:t.usd_to_inr_rate}),i.error)throw i.error;l.success("Currency settings saved successfully")}catch(r){console.error("Error saving currency settings:",r),l.error("Failed to save currency settings")}finally{f(!1)}}};return e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"px-4 py-4 sm:px-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Configure Currency Preferences"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Set your preferred currency and conversion rates for revenue calculations."})]}),e.jsxs("form",{onSubmit:g(b),children:[e.jsx("div",{className:"px-4 py-5 sm:p-6 space-y-6",children:u?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-blue-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"preferred_currency",className:"block text-sm font-medium text-gray-700",children:"Preferred Currency"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"This currency will be used to display your revenue totals on the dashboard."}),e.jsxs("select",{id:"preferred_currency",...y("preferred_currency",{required:"Preferred currency is required"}),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"INR",children:"â‚¹ INR - Indian Rupee"}),e.jsx("option",{value:"USD",children:"$ USD - US Dollar"})]}),n.preferred_currency&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.preferred_currency.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"usd_to_inr_rate",className:"block text-sm font-medium text-gray-700",children:"USD to INR Conversion Rate"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Enter the current exchange rate for converting between USD and INR."}),e.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm",children:"1 USD ="}),e.jsx("input",{type:"number",id:"usd_to_inr_rate",...y("usd_to_inr_rate",{required:"Conversion rate is required",min:{value:.01,message:"Rate must be positive"},valueAsNumber:!0}),step:"0.01",className:"flex-1 min-w-0 block w-full px-3 py-2 rounded-none border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),e.jsx("span",{className:"inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm",children:"INR"})]}),n.usd_to_inr_rate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.usd_to_inr_rate.message})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md border border-blue-100",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Currency Conversion Info"}),e.jsx("p",{className:"mt-1 text-sm text-blue-700",children:"This exchange rate will be used to convert between currencies in your revenue reports and dashboard. For accurate financial records, please update this rate regularly to reflect current exchange rates."})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:x||u||!p,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),x?"Saving...":"Save Settings"]})})]})]})})};export{C as default};
