import{c as C,r,j as e,V as f}from"./index-DMTdQ3St.js";import{M as D}from"./Modal-D67shZbf.js";import{I as P}from"./InvoicePreviewContent--PJ4DIc5.js";import{h as S,E as I}from"./jspdf.es.min-CZuQBE25.js";import{D as k}from"./download-CvjdIAOH.js";import{S as E}from"./send-BrKxFpSO.js";import{S as z}from"./save-Cq4unuqE.js";import"./x-CNnEMBry.js";import"./helpers-kgrKKtTT.js";import"./invoiceDataTransform-CE6YmDep.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=C("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),J=({isOpen:h,onClose:p,data:n,onSave:g,onSend:t,isSaving:a,isUpdate:w=!1})=>{r.useState(!1);const[l,d]=r.useState(!1),[c,m]=r.useState(!1),[R,b]=r.useState(window.innerWidth<640),i=r.useRef(null);r.useEffect(()=>{const s=()=>{b(window.innerWidth<640)};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const y=async()=>{if(i.current){d(!0);try{const s=i.current.cloneNode(!0);s.classList.add("pdf-mode"),s.style.position="absolute",s.style.left="-9999px",s.style.width="1024px",document.body.appendChild(s);const o=await S(s,{scale:1.5,logging:!1,useCORS:!0,allowTaint:!0,backgroundColor:"#FFFFFF",windowWidth:1200,width:1024});document.body.removeChild(s);const N=o.toDataURL("image/jpeg",.8),u=new I({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),x=210,F=o.height*x/o.width;u.addImage(N,"JPEG",0,0,x,F),u.save(`Invoice-${n.invoice.invoice_number}.pdf`),f.success("PDF downloaded successfully")}catch(s){console.error("Error generating PDF:",s),f.error("Failed to generate PDF")}finally{d(!1)}}},v=()=>{window.print()},j=async()=>{if(t){m(!0);try{await t()}finally{m(!1)}}};return e.jsx(D,{isOpen:h,onClose:p,size:"full",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center p-3 sm:p-4 border-b border-gray-200 gap-y-2",style:{borderColor:`${n.issuer.primary_color||"#3B82F6"}20`},children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",style:{color:n.issuer.primary_color||"#3B82F6"},children:"Invoice Preview"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md shadow-sm text-xs sm:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:y,disabled:l,children:[e.jsx(k,{size:16,className:"mr-1.5"}),e.jsx("span",{className:"hidden xs:inline",children:l?"Generating...":"Download PDF"})]}),e.jsxs("button",{type:"button",onClick:v,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md shadow-sm text-xs sm:text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(M,{size:16,className:"mr-1.5"}),e.jsx("span",{className:"hidden xs:inline",children:"Print"})]}),t&&e.jsxs("button",{type:"button",onClick:j,disabled:c,className:"inline-flex items-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs sm:text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(E,{size:16,className:"mr-1.5"}),e.jsx("span",{className:"hidden xs:inline",children:c?"Sending...":"Send"})]}),e.jsx("button",{type:"button",onClick:g,disabled:a,className:"inline-flex items-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs sm:text-sm font-medium text-white",style:{backgroundColor:n.issuer.primary_color||"#3B82F6",borderColor:`${n.issuer.primary_color||"#3B82F6"}80`},children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-1.5 h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"hidden xs:inline",children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{size:16,className:"mr-1.5"}),e.jsx("span",{className:"hidden xs:inline",children:w?"Update":"Save"})]})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-100 p-2 sm:p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl overflow-hidden shadow-lg",ref:i,children:e.jsx(P,{data:n})})})]})})};export{J as default};
