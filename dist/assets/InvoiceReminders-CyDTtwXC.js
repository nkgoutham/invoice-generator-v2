import{c as M,l as E,s as u,u as I,r as x,j as e,V as c}from"./index-DMTdQ3St.js";import{u as B,a as y}from"./index.esm-DkrFlcfS.js";import{M as P}from"./mail-CvfNZUA1.js";import{A as j}from"./alert-circle-DEjQuPjF.js";import{P as v}from"./plus-C1YCJXOA.js";import{C as T}from"./clock-BUTmNg2j.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=M("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),V=E(s=>({reminderSettings:null,loading:!1,error:null,fetchReminderSettings:async r=>{try{s({loading:!0,error:null});const{data:n,error:a}=await u.from("invoice_reminders").select("*").eq("user_id",r).maybeSingle();if(a)throw a;s({reminderSettings:n})}catch(n){console.error("Error fetching reminder settings:",n),s({error:n.message||"Failed to fetch reminder settings"})}finally{s({loading:!1})}},createReminderSettings:async(r,n)=>{try{s({loading:!0,error:null});const{data:a,error:d}=await u.from("invoice_reminders").insert({user_id:n,days_before_due:r.days_before_due,days_after_due:r.days_after_due,reminder_subject:r.reminder_subject,reminder_message:r.reminder_message,enabled:r.enabled}).select().single();if(d)throw d;return s({reminderSettings:a}),a}catch(a){return console.error("Error creating reminder settings:",a),s({error:a.message||"Failed to create reminder settings"}),null}finally{s({loading:!1})}},updateReminderSettings:async(r,n)=>{try{s({loading:!0,error:null});const{data:a,error:d}=await u.from("invoice_reminders").update(n).eq("id",r).select().single();if(d)throw d;s({reminderSettings:a})}catch(a){console.error("Error updating reminder settings:",a),s({error:a.message||"Failed to update reminder settings"})}finally{s({loading:!1})}}})),J=()=>{const{user:s}=I(),{reminderSettings:r,fetchReminderSettings:n,createReminderSettings:a,updateReminderSettings:d,loading:f}=V(),[_,g]=x.useState(!1),{register:l,control:b,handleSubmit:S,reset:h,formState:{errors:p,isDirty:w}}=B({defaultValues:{days_before_due:[7,1],days_after_due:[1,3,7],reminder_subject:"Invoice Reminder: #{invoice_number}",reminder_message:"This is a friendly reminder that invoice #{invoice_number} for {amount} is {status}. Please make payment at your earliest convenience.",enabled:!0}}),{fields:o,append:R,remove:k}=y({control:b,name:"days_before_due"}),{fields:m,append:D,remove:A}=y({control:b,name:"days_after_due"});x.useEffect(()=>{s&&n(s.id)},[s,n]),x.useEffect(()=>{r&&h({days_before_due:r.days_before_due,days_after_due:r.days_after_due,reminder_subject:r.reminder_subject,reminder_message:r.reminder_message,enabled:r.enabled})},[r,h]);const q=()=>{R(1)},C=()=>{D(1)},F=async t=>{if(s)try{r?await d(r.id,t):await a(t,s.id),g(!0),setTimeout(()=>g(!1),3e3),c.success("Reminder settings saved successfully")}catch(i){console.error("Failed to save reminder settings:",i),c.error("Failed to save reminder settings")}};return e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"px-4 py-4 sm:px-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Configure Invoice Reminders"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Set up automatic email reminders to be sent to clients before and after invoice due dates."})]}),e.jsxs("form",{onSubmit:S(F),children:[e.jsxs("div",{className:"px-4 py-5 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"enabled",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...l("enabled")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"enabled",className:"font-medium text-gray-700",children:"Enable invoice reminders"}),e.jsx("p",{className:"text-gray-500",children:"When enabled, reminders will be sent automatically based on your settings."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-base font-medium text-gray-900",children:"Reminders Before Due Date"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Send reminders to clients before invoices are due."}),e.jsxs("div",{className:"mt-3 space-y-3",children:[o.map((t,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",className:"w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",min:"1",max:"90",...l(`days_before_due.${i}`,{required:"Required",min:{value:1,message:"Min 1 day"},max:{value:90,message:"Max 90 days"}})}),e.jsxs("span",{className:"text-sm text-gray-700",children:["day",parseInt(t.toString())!==1?"s":""," before due date"]}),e.jsx("button",{type:"button",onClick:()=>{o.length>1?k(i):c.error("At least one reminder is required")},className:"ml-auto p-1 text-gray-400 hover:text-red-500",children:e.jsx(N,{className:"h-4 w-4"})})]},t.id)),p.days_before_due&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"Please enter valid days (1-90)"]}),e.jsxs("button",{type:"button",onClick:q,className:"mt-2 inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(v,{className:"h-3.5 w-3.5 mr-1"}),"Add Reminder"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-base font-medium text-gray-900",children:"Reminders After Due Date"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Send reminders to clients after invoices are overdue."}),e.jsxs("div",{className:"mt-3 space-y-3",children:[m.map((t,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",className:"w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",min:"1",max:"90",...l(`days_after_due.${i}`,{required:"Required",min:{value:1,message:"Min 1 day"},max:{value:90,message:"Max 90 days"}})}),e.jsxs("span",{className:"text-sm text-gray-700",children:["day",parseInt(t.toString())!==1?"s":""," after due date"]}),e.jsx("button",{type:"button",onClick:()=>{m.length>1?A(i):c.error("At least one reminder is required")},className:"ml-auto p-1 text-gray-400 hover:text-red-500",children:e.jsx(N,{className:"h-4 w-4"})})]},t.id)),p.days_after_due&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"Please enter valid days (1-90)"]}),e.jsxs("button",{type:"button",onClick:C,className:"mt-2 inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(v,{className:"h-3.5 w-3.5 mr-1"}),"Add Reminder"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:"Email Template"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Customize the email subject and message for reminders. Use placeholders: ",e.jsx("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"{invoice_number}"}),",",e.jsx("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"{amount}"}),",",e.jsx("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"{due_date}"}),",",e.jsx("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"{status}"})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reminder_subject",className:"block text-sm font-medium text-gray-700",children:"Email Subject"}),e.jsx("input",{type:"text",id:"reminder_subject",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Invoice Reminder: #{invoice_number}",...l("reminder_subject",{required:"Subject is required"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reminder_message",className:"block text-sm font-medium text-gray-700",children:"Email Message"}),e.jsx("textarea",{id:"reminder_message",rows:4,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"This is a friendly reminder that invoice #{invoice_number} for {amount} is {status}. Please make payment at your earliest convenience.",...l("reminder_message",{required:"Message is required"})})]})]})]}),e.jsxs("div",{className:"mt-6 bg-gray-50 p-4 rounded-md border border-gray-200",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(T,{className:"h-4 w-4 text-gray-500 mr-2"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Reminder Schedule Preview"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Based on your settings, reminders will be sent at these times:"}),e.jsxs("div",{className:"space-y-1.5 text-sm",children:[o.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Before due date:"})," ",o.map((t,i)=>e.jsxs("span",{className:"inline-flex items-center ml-1 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[t.toString()," day",parseInt(t.toString())!==1?"s":""," before",i<o.length-1?", ":""]},t.id))]}),m.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"After due date:"})," ",m.map((t,i)=>e.jsxs("span",{className:"inline-flex items-center ml-1 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[t.toString()," day",parseInt(t.toString())!==1?"s":""," after",i<m.length-1?", ":""]},t.id))]})]})]})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 text-right sm:px-6 flex justify-end",children:[_&&e.jsxs("div",{className:"mr-3 inline-flex items-center px-3 py-2 text-sm text-green-700 bg-green-100 rounded-md",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Saved successfully"]}),e.jsx("button",{type:"submit",disabled:f||!w&&r!==null,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:f?"Saving...":"Save Settings"})]})]})]})})},L=({className:s})=>e.jsxs("svg",{className:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]});export{J as default};
