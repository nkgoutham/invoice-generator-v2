import{d as M,a as B,u as $,r as c,j as e,D as G,F as O,V as F}from"./index-DMTdQ3St.js";import{u as V}from"./index.esm-DkrFlcfS.js";import{u as z}from"./expenseStore-BpTe1G7s.js";import{u as L}from"./clientStore-Bedc05g4.js";import{A as Q}from"./arrow-left-DgZupmuo.js";import{C as W}from"./calendar-CRwE0Pfy.js";import{T as Y}from"./tag-ilgYDLAU.js";import{P as H}from"./plus-C1YCJXOA.js";import{T as S}from"./trash-2-B7Y99Ql6.js";import{U as J}from"./upload-CjiI9HH6.js";import{B as X}from"./building-BwG9NAGn.js";import{X as K}from"./x-CNnEMBry.js";const Z=[{value:"cash",label:"Cash"},{value:"credit_card",label:"Credit Card"},{value:"bank_transfer",label:"Bank Transfer"},{value:"upi",label:"UPI"},{value:"other",label:"Other"}],ee=[{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"},{value:"yearly",label:"Yearly"}],be=()=>{const{id:d}=M(),u=B(),{user:n}=$(),{selectedExpense:r,fetchExpense:f,updateExpense:q,uploadReceipt:R,categories:E,fetchCategories:g,loading:x}=z(),{clients:I,fetchClients:y}=L(),[o,j]=c.useState(null),[N,m]=c.useState(null),[v,w]=c.useState(!1),[U,b]=c.useState(!1),{register:a,handleSubmit:A,control:se,watch:p,setValue:l,formState:{errors:t}}=V({defaultValues:{date:new Date().toISOString().split("T")[0],amount:0,description:"",category_id:"",is_recurring:!1,is_billable:!1,is_reimbursable:!1,reimbursed:!1,currency:"INR"}}),_=p("is_recurring"),k=p("is_billable"),D=p("is_reimbursable");c.useEffect(()=>{d&&f(d),n&&(g(n.id),y(n.id))},[d,n,f,g,y]),c.useEffect(()=>{r&&(l("date",r.date),l("amount",r.amount),l("description",r.description),l("category_id",r.category_id||""),l("client_id",r.client_id||""),l("invoice_id",r.invoice_id||""),l("is_recurring",r.is_recurring||!1),l("recurring_frequency",r.recurring_frequency||""),l("notes",r.notes||""),l("is_billable",r.is_billable||!1),l("is_reimbursable",r.is_reimbursable||!1),l("reimbursed",r.reimbursed||!1),l("payment_method",r.payment_method||""),l("currency",r.currency||"INR"),r.receipt_url&&m(r.receipt_url))},[r,l]);const T=s=>{if(s.target.files&&s.target.files[0]){const i=s.target.files[0];if(j(i),i.type.startsWith("image/")){const h=new FileReader;h.onload=()=>{m(h.result)},h.readAsDataURL(i)}else m(null)}},C=()=>{j(null),m(null);const s=document.getElementById("receipt");s&&(s.value="")},P=async s=>{if(!(!n||!d))try{w(!0);let i=(r==null?void 0:r.receipt_url)||null;if(o&&(i=await R(o,n.id),!i))throw new Error("Failed to upload receipt");await q(d,{...s,user_id:n.id,receipt_url:i,recurring_frequency:s.is_recurring?s.recurring_frequency:null,client_id:s.is_billable?s.client_id:null}),F.success("Expense updated successfully"),u("/expenses")}catch(i){F.error(i.message||"Failed to update expense")}finally{w(!1)}};return x&&!r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-0",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>u("/expenses"),className:"text-gray-500 hover:text-gray-700 mr-4",children:e.jsx(Q,{size:20})}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Edit Expense"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("form",{onSubmit:A(P),className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",id:"date",className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.date?"border-red-300":"border-gray-300"}`,...a("date",{required:"Date is required"})})]}),t.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.date.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount *"}),e.jsxs("div",{className:"relative flex",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(G,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",id:"amount",step:"0.01",min:"0",className:`block w-full pl-10 pr-3 py-2 border rounded-l-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.amount?"border-red-300":"border-gray-300"}`,placeholder:"",...a("amount",{required:"Amount is required",min:{value:.01,message:"Amount must be greater than 0"},valueAsNumber:!0})}),e.jsxs("select",{className:"block w-24 border-l-0 border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...a("currency"),children:[e.jsx("option",{value:"INR",children:"₹ INR"}),e.jsx("option",{value:"USD",children:"$ USD"})]})]}),t.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.amount.message})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("input",{type:"text",id:"description",className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.description?"border-red-300":"border-gray-300"}`,placeholder:"e.g., Office supplies, Software subscription",...a("description",{required:"Description is required"})}),t.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Y,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{id:"category_id",className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.category_id?"border-red-300":"border-gray-300"}`,...a("category_id",{required:"Category is required"}),children:[e.jsx("option",{value:"",children:"Select a category"}),E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.category_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.category_id.message}),e.jsxs("button",{type:"button",onClick:()=>b(!0),className:"mt-1 text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(H,{className:"h-3 w-3 mr-1"})," Manage categories"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{id:"payment_method",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...a("payment_method"),children:[e.jsx("option",{value:"",children:"Select payment method"}),Z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Additional Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"receipt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Receipt (optional)"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:e.jsx("div",{className:"space-y-1 text-center",children:N?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N,alt:"Receipt preview",className:"mx-auto h-32 object-contain"}),e.jsx("button",{type:"button",onClick:C,className:"absolute top-0 right-0 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition-colors",children:e.jsx(S,{className:"h-4 w-4"})})]}):o?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(O,{className:"h-10 w-10 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:o.name}),e.jsx("button",{type:"button",onClick:C,className:"absolute top-0 right-0 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition-colors",children:e.jsx(S,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{htmlFor:"receipt",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"receipt",name:"receipt",type:"file",className:"sr-only",accept:"image/jpeg,image/png,image/gif,application/pdf",onChange:T})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 5MB"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(J,{className:"h-10 w-10 text-gray-300"})})]})})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{id:"notes",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm resize-none",placeholder:"Add any additional details about this expense",...a("notes")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"is_recurring",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...a("is_recurring")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"is_recurring",className:"font-medium text-gray-700",children:"Recurring expense"}),e.jsx("p",{className:"text-gray-500",children:"This expense occurs regularly"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"is_billable",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...a("is_billable")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"is_billable",className:"font-medium text-gray-700",children:"Billable to client"}),e.jsx("p",{className:"text-gray-500",children:"Charge this expense to a client"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"is_reimbursable",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...a("is_reimbursable")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"is_reimbursable",className:"font-medium text-gray-700",children:"Reimbursable"}),e.jsx("p",{className:"text-gray-500",children:"This expense will be reimbursed"})]})]})]}),_&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recurring_frequency",className:"block text-sm font-medium text-gray-700 mb-1",children:"Recurring Frequency"}),e.jsxs("select",{id:"recurring_frequency",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...a("recurring_frequency",{required:_?"Frequency is required for recurring expenses":!1}),children:[e.jsx("option",{value:"",children:"Select frequency"}),ee.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),t.recurring_frequency&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.recurring_frequency.message})]}),k&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"client_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(X,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{id:"client_id",className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${t.client_id?"border-red-300":"border-gray-300"}`,...a("client_id",{required:k?"Client is required for billable expenses":!1}),children:[e.jsx("option",{value:"",children:"Select a client"}),I.map(s=>e.jsx("option",{value:s.id,children:s.company_name?`${s.name} (${s.company_name})`:s.name},s.id))]})]}),t.client_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.client_id.message})]}),D&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"reimbursed",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...a("reimbursed")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"reimbursed",className:"font-medium text-gray-700",children:"Already reimbursed"}),e.jsx("p",{className:"text-gray-500",children:"Mark if you've already been reimbursed for this expense"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u("/expenses"),className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x||v,className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-70",children:x||v?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"h-4 w-4 mr-2 rounded-full border-2 border-white/30 border-t-white animate-spin"}),"Saving..."]}):"Update Expense"})]})]})})}),U&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:()=>b(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:e.jsxs("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>b(!1),children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(K,{className:"h-6 w-6"})]})}),e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"})]})]})})]})};export{be as default};
