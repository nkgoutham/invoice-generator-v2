import{a as I,u as A,r as c,j as e,D,F as U,V as v}from"./index-DMTdQ3St.js";import{u as T}from"./index.esm-DkrFlcfS.js";import{u as P}from"./expenseStore-BpTe1G7s.js";import{u as B}from"./clientStore-Bedc05g4.js";import{A as $}from"./arrow-left-DgZupmuo.js";import{C as M}from"./calendar-CRwE0Pfy.js";import{T as G}from"./tag-ilgYDLAU.js";import{P as O}from"./plus-C1YCJXOA.js";import{T as w}from"./trash-2-B7Y99Ql6.js";import{U as V}from"./upload-CjiI9HH6.js";import{B as z}from"./building-BwG9NAGn.js";const L=[{value:"cash",label:"Cash"},{value:"credit_card",label:"Credit Card"},{value:"bank_transfer",label:"Bank Transfer"},{value:"upi",label:"UPI"},{value:"other",label:"Other"}],Q=[{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"},{value:"yearly",label:"Yearly"}],ie=()=>{const d=I(),{user:a}=A(),{createExpense:_,categories:k,fetchCategories:u,uploadReceipt:F,loading:x}=P(),{clients:S,fetchClients:b}=B(),[i,p]=c.useState(null),[h,o]=c.useState(null),[f,g]=c.useState(!1),{register:t,handleSubmit:C,control:W,watch:m,setValue:Y,formState:{errors:r}}=T({defaultValues:{date:new Date().toISOString().split("T")[0],amount:0,description:"",category_id:"",is_recurring:!1,is_billable:!1,is_reimbursable:!1,reimbursed:!1,currency:"INR"}}),y=m("is_recurring"),j=m("is_billable"),R=m("is_reimbursable");c.useEffect(()=>{a&&(u(a.id),b(a.id))},[a,u,b]);const q=s=>{if(s.target.files&&s.target.files[0]){const l=s.target.files[0];if(p(l),l.type.startsWith("image/")){const n=new FileReader;n.onload=()=>{o(n.result)},n.readAsDataURL(l)}else o(null)}},N=()=>{p(null),o(null);const s=document.getElementById("receipt");s&&(s.value="")},E=async s=>{if(a)try{g(!0);let l=null;if(i&&(l=await F(i,a.id),!l))throw new Error("Failed to upload receipt");await _({...s,user_id:a.id,receipt_url:l,recurring_frequency:s.is_recurring?s.recurring_frequency:null,client_id:s.is_billable?s.client_id:null})&&(v.success("Expense added successfully"),d("/expenses"))}catch(l){v.error(l.message||"Failed to add expense")}finally{g(!1)}};return e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-0",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>d("/expenses"),className:"text-gray-500 hover:text-gray-700 mr-4",children:e.jsx($,{size:20})}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Add New Expense"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("form",{onSubmit:C(E),className:"p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",id:"date",className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${r.date?"border-red-300":"border-gray-300"}`,...t("date",{required:"Date is required"})})]}),r.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.date.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount *"}),e.jsxs("div",{className:"relative flex",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(D,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"number",id:"amount",step:"0.01",min:"0",className:`block w-full pl-10 pr-3 py-2 border rounded-l-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${r.amount?"border-red-300":"border-gray-300"}`,placeholder:"",...t("amount",{required:"Amount is required",min:{value:.01,message:"Amount must be greater than 0"},valueAsNumber:!0})}),e.jsxs("select",{className:"block w-24 border-l-0 border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...t("currency"),children:[e.jsx("option",{value:"INR",children:"â‚¹ INR"}),e.jsx("option",{value:"USD",children:"$ USD"})]})]}),r.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.amount.message})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx("input",{type:"text",id:"description",className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${r.description?"border-red-300":"border-gray-300"}`,placeholder:"e.g., Office supplies, Software subscription",...t("description",{required:"Description is required"})}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(G,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{id:"category_id",className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${r.category_id?"border-red-300":"border-gray-300"}`,...t("category_id",{required:"Category is required"}),children:[e.jsx("option",{value:"",children:"Select a category"}),k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),r.category_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.category_id.message}),e.jsxs("button",{type:"button",className:"mt-1 text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"})," Manage categories"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"payment_method",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{id:"payment_method",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...t("payment_method"),children:[e.jsx("option",{value:"",children:"Select payment method"}),L.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h2",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Additional Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"receipt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Receipt (optional)"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:e.jsx("div",{className:"space-y-1 text-center",children:h?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h,alt:"Receipt preview",className:"mx-auto h-32 object-contain"}),e.jsx("button",{type:"button",onClick:N,className:"absolute top-0 right-0 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition-colors",children:e.jsx(w,{className:"h-4 w-4"})})]}):i?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(U,{className:"h-10 w-10 text-gray-400"})}),e.jsx("p",{className:"text-sm text-gray-500",children:i.name}),e.jsx("button",{type:"button",onClick:N,className:"absolute top-0 right-0 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200 transition-colors",children:e.jsx(w,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{htmlFor:"receipt",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"receipt",name:"receipt",type:"file",className:"sr-only",accept:"image/jpeg,image/png,image/gif,application/pdf",onChange:q})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 5MB"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(V,{className:"h-10 w-10 text-gray-300"})})]})})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{id:"notes",rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm resize-none",placeholder:"Add any additional details about this expense",...t("notes")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"is_recurring",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...t("is_recurring")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"is_recurring",className:"font-medium text-gray-700",children:"Recurring expense"}),e.jsx("p",{className:"text-gray-500",children:"This expense occurs regularly"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"is_billable",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...t("is_billable")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"is_billable",className:"font-medium text-gray-700",children:"Billable to client"}),e.jsx("p",{className:"text-gray-500",children:"Charge this expense to a client"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"is_reimbursable",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...t("is_reimbursable")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"is_reimbursable",className:"font-medium text-gray-700",children:"Reimbursable"}),e.jsx("p",{className:"text-gray-500",children:"This expense will be reimbursed"})]})]})]}),y&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recurring_frequency",className:"block text-sm font-medium text-gray-700 mb-1",children:"Recurring Frequency"}),e.jsxs("select",{id:"recurring_frequency",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",...t("recurring_frequency",{required:y?"Frequency is required for recurring expenses":!1}),children:[e.jsx("option",{value:"",children:"Select frequency"}),Q.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),r.recurring_frequency&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.recurring_frequency.message})]}),j&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"client_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Client"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(z,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("select",{id:"client_id",className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${r.client_id?"border-red-300":"border-gray-300"}`,...t("client_id",{required:j?"Client is required for billable expenses":!1}),children:[e.jsx("option",{value:"",children:"Select a client"}),S.map(s=>e.jsx("option",{value:s.id,children:s.company_name?`${s.name} (${s.company_name})`:s.name},s.id))]})]}),r.client_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.client_id.message})]}),R&&e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"reimbursed",type:"checkbox",className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded",...t("reimbursed")})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"reimbursed",className:"font-medium text-gray-700",children:"Already reimbursed"}),e.jsx("p",{className:"text-gray-500",children:"Mark if you've already been reimbursed for this expense"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d("/expenses"),className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x||f,className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-70",children:x||f?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"h-4 w-4 mr-2 rounded-full border-2 border-white/30 border-t-white animate-spin"}),"Saving..."]}):"Save Expense"})]})]})})})]})};export{ie as default};
